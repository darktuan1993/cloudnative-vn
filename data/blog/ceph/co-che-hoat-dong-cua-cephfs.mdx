---
title: 'C∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa CephFS'
description: 'Gi·ªõi thi·ªáu v·ªÅ CephFS - h·ªá th·ªëng t·ªáp ph√¢n t√°n m·∫°nh m·∫Ω v√† linh ho·∫°t'
date: '2024-03-18'
tags: ['Cloudnative', 'Storage', 'Ceph']
authors: ['bachdangtuan']
---

# C∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa CephFS

## CephFS l√† g√¨?

**CephFS (Ceph File System)** l√† m·ªôt h·ªá th·ªëng **l∆∞u tr·ªØ file ph√¢n t√°n** ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± nh∆∞:

- M·ªôt **·ªï ƒëƒ©a m·∫°ng (shared drive)**, n∆°i nhi·ªÅu m√°y t√≠nh ho·∫∑c ·ª©ng d·ª•ng c√≥ th·ªÉ truy c·∫≠p c√πng l√∫c.
- Nh∆∞ng kh√°c ·ªü ch·ªó: d·ªØ li·ªáu ƒë∆∞·ª£c **l∆∞u tr√™n nhi·ªÅu ·ªï ƒëƒ©a, nhi·ªÅu m√°y ch·ªß**, c√≥ kh·∫£ nƒÉng **ph√¢n t√°n, sao l∆∞u v√† t·ª± ph·ª•c h·ªìi**.

---

## C∆° ch·∫ø ho·∫°t ƒë·ªông CephFS (d·ªÖ hi·ªÉu cho ng∆∞·ªùi m·ªõi)

### 1. Metadata Server (MDS) ‚Äì Ng∆∞·ªùi qu·∫£n l√Ω file

- Qu·∫£n l√Ω th√¥ng tin file nh∆∞ t√™n, ƒë∆∞·ªùng d·∫´n, quy·ªÅn truy c·∫≠p, th·ªùi gian s·ª≠a ƒë·ªïi‚Ä¶
- Khi b·∫°n m·ªü file, CephFS h·ªèi **MDS: ‚ÄúFile n√†y ·ªü ƒë√¢u?‚Äù**
- MDS kh√¥ng l∆∞u tr·ªØ d·ªØ li·ªáu th·ª±c t·∫ø m√† ch·ªâ l∆∞u tr·ªØ th√¥ng tin v·ªÅ v·ªã tr√≠ c·ªßa c√°c block d·ªØ li·ªáu.
- MDS c√≥ th·ªÉ x·ª≠ l√Ω nhi·ªÅu y√™u c·∫ßu c√πng l√∫c, gi√∫p tƒÉng t·ªëc ƒë·ªô truy c·∫≠p file.

Ng∆∞·ªùi d√πng (Client A) m·ªü file `/docs/report.pdf` ƒë∆∞·ª£c l∆∞u tr·ªØ trong CephFS.

#### üì• C√°c b∆∞·ªõc ng∆∞·ªùi d√πng l·∫•y d·ªØ li·ªáu:

            1. **Client A** y√™u c·∫ßu m·ªü file `report.pdf`.
            2. **MDS (Metadata Server)** ki·ªÉm tra:
               - File c√≥ t·ªìn t·∫°i kh√¥ng?
               - Ai ƒëang truy c·∫≠p?
               - File n·∫±m ·ªü ƒë√¢u tr√™n cluster?
            3. MDS tr·∫£ v·ªÅ th√¥ng tin file, v·ªã tr√≠ c√°c block d·ªØ li·ªáu trong h·ªá th·ªëng.
            4. **Client A** k·∫øt n·ªëi tr·ª±c ti·∫øp t·ªõi c√°c **OSD** ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu (file c√≥ th·ªÉ n·∫±m ·ªü nhi·ªÅu OSD).
            5. File ƒë∆∞·ª£c t·∫≠p h·ª£p l·∫°i th√†nh `report.pdf` v√† hi·ªÉn th·ªã cho ng∆∞·ªùi d√πng.
            6. N·∫øu c√≥ l·ªói (v√≠ d·ª• 1 OSD h·ªèng), Ceph s·∫Ω t·ª± ƒë·ªông l·∫•y b·∫£n sao t·ª´ OSD kh√°c m√† ng∆∞·ªùi d√πng kh√¥ng h·ªÅ nh·∫≠n ra s·ª± c·ªë.
            7. N·∫øu nhi·ªÅu ng∆∞·ªùi c√πng m·ªü file, MDS s·∫Ω chia t·∫£i cho c√°c OSD kh√°c nhau ƒë·ªÉ tr√°nh ngh·∫Ωn.
            8. N·∫øu c√≥ thay ƒë·ªïi (th√™m, s·ª≠a, x√≥a file), MDS s·∫Ω c·∫≠p nh·∫≠t th√¥ng tin v√† th√¥ng b√°o cho c√°c OSD.

```
+------------+               +------------+
|  Client A  |               |   Client B |
+------------+               +------------+
       |                           |
       |     Request: /docs/report.pdf
       |-------------------------->|
       |                           |
       |         +---------------+
       |         |     MDS       |  ‚Üê Metadata Server
       |<--------|  Lookup file  |
       |         +---------------+
       |                |
       |                v
       |      "File is on OSD2, OSD5"
       |                |
       v                v
+------------+   +------------+   +------------+
|   OSD 1    |   |   OSD 2    |   |   OSD 5    |  ‚Üê Ch·ª©a d·ªØ li·ªáu file
+------------+   +------------+   +------------+
```

---

#### üì• C√°c b∆∞·ªõc ng∆∞·ªùi upload v√† l∆∞u d·ªØ li·ªáu:

1. Client g·ª≠i request ghi file

- G·ª≠i request ghi /docs/report.pdf t·ªõi CephFS mountpoint.
- Giao ti·∫øp v·ªõi MDS (Metadata Server) ƒë·ªÉ:
- T·∫°o entry metadata cho file m·ªõi.
- G√°n inode, quy·ªÅn truy c·∫≠p, ƒë∆∞·ªùng d·∫´n.

2. File ƒë∆∞·ª£c chia nh·ªè th√†nh c√°c block

- CephFS s·ª≠ d·ª•ng c∆° ch·∫ø l∆∞u d·ªØ li·ªáu c·ªßa RADOS, n√™n file s·∫Ω ƒë∆∞·ª£c:
- Chia th√†nh c√°c chunk nh·ªè (th∆∞·ªùng 4MB m·ªói block ‚Äì configurable)
- G√°n Object ID cho t·ª´ng block.
- L∆∞u tr·ªØ ph√¢n t√°n l√™n c√°c OSD kh√°c nhau.

- V√≠ d·ª•: report.pdf (100 MB) ‚Üí chia th√†nh 25 block ‚Üí m·ªói block l∆∞u tr√™n 1 OSD, ho·∫∑c nhi·ªÅu b·∫£n sao.

3. Replication (t·ª± sao l∆∞u)

- M·ªói block ƒë∆∞·ª£c replica (m·∫∑c ƒë·ªãnh 3 b·∫£n) ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n d·ªØ li·ªáu.
- V√≠ d·ª•:

Block 1 ‚Üí OSD1, OSD3, OSD5

Block 2 ‚Üí OSD2, OSD4, OSD6

4. MDS c·∫≠p nh·∫≠t metadata
   L∆∞u th√¥ng tin:
   report.pdf g·ªìm 25 block, c√°c block n·∫±m ·ªü ƒë√¢u, block n√†o thu·ªôc OSD n√†o.

5. Ghi ho√†n t·∫•t
   Sau khi d·ªØ li·ªáu v√† metadata ƒë·ªÅu ƒë∆∞·ª£c commit th√†nh c√¥ng ‚Üí client nh·∫≠n ph·∫£n h·ªìi ‚Äúghi th√†nh c√¥ng‚Äù.

```
[Client]
   |
   |----> Request ghi file /docs/report.pdf
   |
 [MDS] -- G√°n inode, metadata
   |
   v
Chia file PDF th√†nh c√°c block nh·ªè (4MB, 8MB...)
   |
   v
+--------+  +--------+  +--------+
| Block1 |  | Block2 |  | Block3 |  ...
+--------+  +--------+  +--------+
   |           |           |
   v           v           v
[OSD1]     [OSD2]      [OSD3]     (v√† c√°c b·∫£n sao ·ªü OSD4,5,6...)


```

---

### 2. OSD ‚Äì N∆°i l∆∞u tr·ªØ d·ªØ li·ªáu th·ª±c t·∫ø

- File ƒë∆∞·ª£c chia nh·ªè th√†nh nhi·ªÅu block v√† l∆∞u tr√™n nhi·ªÅu **OSD (Object Storage Daemon)** kh√°c nhau.
- D·ªØ li·ªáu c√≥ th·ªÉ ph√¢n t√°n tr√™n nhi·ªÅu ·ªï c·ª©ng v·∫≠t l√Ω.

### 3. T·ª± ƒë·ªông sao l∆∞u (Replication)

- M·ªói block d·ªØ li·ªáu s·∫Ω c√≥ nhi·ªÅu b·∫£n sao (th∆∞·ªùng l√† 3) n·∫±m ·ªü c√°c OSD kh√°c nhau.
- N·∫øu m·ªôt OSD h·ªèng ‚Üí Ceph t·ª± ph·ª•c h·ªìi t·ª´ c√°c b·∫£n sao kh√°c.

### 4. Ph√¢n t·∫£i & s·∫µn s√†ng cao (High Availability)

- N·∫øu nhi·ªÅu ng∆∞·ªùi truy c·∫≠p ‚Üí Ceph d√πng nhi·ªÅu MDS ƒë·ªÉ chia t·∫£i.
- Ceph ph√¢n ph·ªëi d·ªØ li·ªáu ƒë·ªÅu tr√™n OSD ƒë·ªÉ tr√°nh ngh·∫Ωn.

### 5. M·ªü r·ªông t·ª± ƒë·ªông

- G·∫Øn th√™m ·ªï c·ª©ng/node m·ªõi ‚Üí Ceph t·ª± ƒë·ªông th√™m v√†o h·ªá th·ªëng, kh√¥ng c·∫ßn d·ª´ng h·ªá th·ªëng.

---

## üìä Minh h·ªça ki·∫øn tr√∫c CephFS
