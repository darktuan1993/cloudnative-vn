---
title: 'CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a CephFS'
description: 'Giá»›i thiá»‡u vá» CephFS - há»‡ thá»‘ng tá»‡p phÃ¢n tÃ¡n máº¡nh máº½ vÃ  linh hoáº¡t'
date: '2024-03-18'
tags: ['Cloudnative', 'Storage', 'Ceph']
authors: ['bachdangtuan']
---

# CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a CephFS

## CephFS lÃ  gÃ¬?

**CephFS (Ceph File System)** lÃ  má»™t há»‡ thá»‘ng **lÆ°u trá»¯ file phÃ¢n tÃ¡n** hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± nhÆ°:

- Má»™t **á»• Ä‘Ä©a máº¡ng (shared drive)**, nÆ¡i nhiá»u mÃ¡y tÃ­nh hoáº·c á»©ng dá»¥ng cÃ³ thá»ƒ truy cáº­p cÃ¹ng lÃºc.
- NhÆ°ng khÃ¡c á»Ÿ chá»—: dá»¯ liá»‡u Ä‘Æ°á»£c **lÆ°u trÃªn nhiá»u á»• Ä‘Ä©a, nhiá»u mÃ¡y chá»§**, cÃ³ kháº£ nÄƒng **phÃ¢n tÃ¡n, sao lÆ°u vÃ  tá»± phá»¥c há»“i**.

---

## CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng CephFS (dá»… hiá»ƒu cho ngÆ°á»i má»›i)

### 1. Metadata Server (MDS) â€“ NgÆ°á»i quáº£n lÃ½ file

- Quáº£n lÃ½ thÃ´ng tin file nhÆ° tÃªn, Ä‘Æ°á»ng dáº«n, quyá»n truy cáº­p, thá»i gian sá»­a Ä‘á»•iâ€¦
- Khi báº¡n má»Ÿ file, CephFS há»i **MDS: â€œFile nÃ y á»Ÿ Ä‘Ã¢u?â€**
- MDS khÃ´ng lÆ°u trá»¯ dá»¯ liá»‡u thá»±c táº¿ mÃ  chá»‰ lÆ°u trá»¯ thÃ´ng tin vá» vá»‹ trÃ­ cá»§a cÃ¡c block dá»¯ liá»‡u.
- MDS cÃ³ thá»ƒ xá»­ lÃ½ nhiá»u yÃªu cáº§u cÃ¹ng lÃºc, giÃºp tÄƒng tá»‘c Ä‘á»™ truy cáº­p file.

NgÆ°á»i dÃ¹ng (Client A) má»Ÿ file `/docs/report.pdf` Ä‘Æ°á»£c lÆ°u trá»¯ trong CephFS.

#### CÃ¡c bÆ°á»›c 1 ngÆ°á»i dÃ¹ng láº¥y dá»¯ liá»‡u:

1. **Client A** yÃªu cáº§u má»Ÿ file `report.pdf`.
2. **MDS (Metadata Server)** kiá»ƒm tra:
   - File cÃ³ tá»“n táº¡i khÃ´ng?
   - Ai Ä‘ang truy cáº­p?
   - File náº±m á»Ÿ Ä‘Ã¢u trÃªn cluster?
3. MDS tráº£ vá» thÃ´ng tin file, vá»‹ trÃ­ cÃ¡c block dá»¯ liá»‡u trong há»‡ thá»‘ng.
4. **Client A** káº¿t ná»‘i trá»±c tiáº¿p tá»›i cÃ¡c **OSD** Ä‘á»ƒ Ä‘á»c dá»¯ liá»‡u (file cÃ³ thá»ƒ náº±m á»Ÿ nhiá»u OSD).
5. File Ä‘Æ°á»£c táº­p há»£p láº¡i thÃ nh `report.pdf` vÃ  hiá»ƒn thá»‹ cho ngÆ°á»i dÃ¹ng.
6. Náº¿u cÃ³ lá»—i (vÃ­ dá»¥ 1 OSD há»ng), Ceph sáº½ tá»± Ä‘á»™ng láº¥y báº£n sao tá»« OSD khÃ¡c mÃ  ngÆ°á»i dÃ¹ng khÃ´ng há» nháº­n ra sá»± cá»‘.
7. Náº¿u nhiá»u ngÆ°á»i cÃ¹ng má»Ÿ file, MDS sáº½ chia táº£i cho cÃ¡c OSD khÃ¡c nhau Ä‘á»ƒ trÃ¡nh ngháº½n.
8. Náº¿u cÃ³ thay Ä‘á»•i (thÃªm, sá»­a, xÃ³a file), MDS sáº½ cáº­p nháº­t thÃ´ng tin vÃ  thÃ´ng bÃ¡o cho cÃ¡c OSD.

```
+------------+               +------------+
|  Client A  |               |   Client B |
+------------+               +------------+
       |                           |
       |     Request: /docs/report.pdf
       |-------------------------->|
       |                           |
       |         +---------------+
       |         |     MDS       |  â† Metadata Server
       |<--------|  Lookup file  |
       |         +---------------+
       |                |
       |                v
       |      "File is on OSD2, OSD5"
       |                |
       v                v
+------------+   +------------+   +------------+
|   OSD 1    |   |   OSD 2    |   |   OSD 5    |  â† Chá»©a dá»¯ liá»‡u file
+------------+   +------------+   +------------+
```

### 2. OSD â€“ NÆ¡i lÆ°u trá»¯ dá»¯ liá»‡u thá»±c táº¿

- File Ä‘Æ°á»£c chia nhá» thÃ nh nhiá»u block vÃ  lÆ°u trÃªn nhiá»u **OSD (Object Storage Daemon)** khÃ¡c nhau.
- Dá»¯ liá»‡u cÃ³ thá»ƒ phÃ¢n tÃ¡n trÃªn nhiá»u á»• cá»©ng váº­t lÃ½.

### 3. Tá»± Ä‘á»™ng sao lÆ°u (Replication)

- Má»—i block dá»¯ liá»‡u sáº½ cÃ³ nhiá»u báº£n sao (thÆ°á»ng lÃ  3) náº±m á»Ÿ cÃ¡c OSD khÃ¡c nhau.
- Náº¿u má»™t OSD há»ng â†’ Ceph tá»± phá»¥c há»“i tá»« cÃ¡c báº£n sao khÃ¡c.

### 4. PhÃ¢n táº£i & sáºµn sÃ ng cao (High Availability)

- Náº¿u nhiá»u ngÆ°á»i truy cáº­p â†’ Ceph dÃ¹ng nhiá»u MDS Ä‘á»ƒ chia táº£i.
- Ceph phÃ¢n phá»‘i dá»¯ liá»‡u Ä‘á»u trÃªn OSD Ä‘á»ƒ trÃ¡nh ngháº½n.

### 5. Má»Ÿ rá»™ng tá»± Ä‘á»™ng

- Gáº¯n thÃªm á»• cá»©ng/node má»›i â†’ Ceph tá»± Ä‘á»™ng thÃªm vÃ o há»‡ thá»‘ng, khÃ´ng cáº§n dá»«ng há»‡ thá»‘ng.

---

## ğŸ“Š Minh há»a kiáº¿n trÃºc CephFS
